<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Surfpack Online Demo</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #e5ecf0;
      }
      .header {
        display: flex;
        align-items: center;
        justify-content: start;
        gap: 15px;
        margin-bottom: 20px;
      }
      .header h1 {
        color: #333;
        margin: 0;
        font-size: 20px;
      }
      .header p {
        color: #666;
        margin: 0;
      }
      .controls {
        margin-bottom: 20px;
        padding: 15px;
        background-color: white;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .left-controls {
        display: flex;
        gap: 20px;
      }
      .control-group {
        display: flex;
        align-items: center;
      }
      .control-group label {
        font-weight: 600;
        font-size: 14px;
        margin-right: 10px;
      }
      .control-group select {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #808080;
        background-color: white;
        font-size: 14px;
      }
      .ui-controls {
        display: flex;
        gap: 15px;
        align-items: center;
      }
      .ui-controls-label {
        font-weight: 600;
        font-size: 14px;
      }
      .checkbox-control {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
        cursor: pointer;
      }
      .checkbox-control input[type="checkbox"] {
        cursor: pointer;
      }
      .surfpack-container {
        /* box-shadow: 0 4px 15px -1px rgba(0, 0, 0, 0.2); */
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>üèÑ‚Äç‚ôÇÔ∏è Surfpack Online Demo</h1>
      <p>A browser-based bundler for modern JavaScript applications</p>
    </div>

    <div class="controls">
      <div class="left-controls">
        <div class="control-group">
          <label for="template-select">Demos :</label>
          <select id="template-select">
            <option value="react-basic">React Counter App</option>
            <option value="react-todo">React Todo App</option>
            <option value="react-weather">React Weather Dashboard</option>
            <option value="vanilla-todo">Vanilla JS Todo App</option>
            <option value="calculator">Calculator App</option>
          </select>
        </div>
        <div class="control-group">
          <label for="theme-select">Theme:</label>
          <select id="theme-select">
            <option value="device-settings">Auto (Device)</option>
            <option value="light">Light</option>
            <option value="dark" selected>Dark</option>
          </select>
        </div>
      </div>
      <div class="ui-controls">
        <span class="ui-controls-label">UI Controls:</span>
        <label class="checkbox-control">
          <input type="checkbox" id="show-code-editor" checked />
          <span>Code Editor</span>
        </label>
        <label class="checkbox-control">
          <input type="checkbox" id="show-file-browser" checked />
          <span>File Browser</span>
        </label>
        <label class="checkbox-control">
          <input type="checkbox" id="show-navigator" checked />
          <span>Navigator</span>
        </label>
      </div>
    </div>

    <div id="surfpack-container" class="surfpack-container"></div>

    <script type="module">
      import { init } from "https://esm.sh/surfpack@latest";

      let demoTemplates;
      let surfpack;
      let currentTemplate = "react-basic";

      // Load templates with error handling
      try {
        const templatesModule = await import("./demo-templates/index.js");
        demoTemplates = templatesModule.demoTemplates;
        console.log("Templates loaded:", Object.keys(demoTemplates));
      } catch (error) {
        console.error("Failed to load templates:", error);
        document.getElementById("surfpack-container").innerHTML =
          `<div style="padding: 20px; color: red;">Failed to load demo templates: ${error.message}</div>`;
      }

      // Only proceed if templates loaded successfully
      if (demoTemplates) {
        const initSurfpack = () => {
          const container = document.getElementById("surfpack-container");
          const template = demoTemplates[currentTemplate];

          console.log(`Initializing template: ${currentTemplate}`, template);

          if (!template) {
            console.error(`Template ${currentTemplate} not found`);
            container.innerHTML = `<div style="padding: 20px; color: red;">Error: Template "${currentTemplate}" not found</div>`;
            return;
          }

          try {
            surfpack = init({
              bundlerUrl: "./online-bundler.html",
              container: container,
              files: template.files,
              entryFile: template.entryFile,
              debugMode: true,
              ui: {
                theme: document.getElementById("theme-select").value || "dark",
                width: "100%",
                height: 600,
                showCodeEditor: true,
                showFileBrowser: true,
                showNavigator: true,
              },
              onBundleComplete: (result) => {
                console.log("Bundle completed:", result);
              },
              onBundleError: (error) => {
                console.error("Bundle error:", error);
              },
              onIframeReady: () => {
                console.log("Iframe is ready");
              },
            });
          } catch (error) {
            console.error("Error initializing Surfpack:", error);
            container.innerHTML = `<div style="padding: 20px; color: red;">Error initializing Surfpack: ${error.message}</div>`;
          }
        };

        // Template switcher
        const templateSelect = document.getElementById("template-select");
        templateSelect.addEventListener("change", (e) => {
          currentTemplate = e.target.value;
          const container = document.getElementById("surfpack-container");

          console.log(`Switching to template: ${currentTemplate}`);

          // Destroy previous instance if it exists
          if (surfpack && surfpack.destroy) {
            surfpack.destroy();
          }

          // Clear the container
          container.innerHTML = "";

          // Small delay to ensure cleanup is complete
          setTimeout(() => {
            initSurfpack();
          }, 100);
        });

        // Theme switcher
        const themeSelect = document.getElementById("theme-select");
        themeSelect.addEventListener("change", (e) => {
          const theme = e.target.value;
          if (surfpack && surfpack.ui) {
            surfpack.ui.setTheme(theme);
          }
        });

        // UI Controls functionality
        const codeEditorCheckbox = document.getElementById("show-code-editor");
        const fileBrowserCheckbox =
          document.getElementById("show-file-browser");
        const navigatorCheckbox = document.getElementById("show-navigator");

        // Function to toggle UI components
        function toggleUIComponent(component, show) {
          if (!surfpack.ui) return;

          switch (component) {
            case "showCodeEditor":
              surfpack.ui.toggleCodeEditor(show);
              break;
            case "showFileBrowser":
              surfpack.ui.toggleFileBrowser(show);
              break;
            case "showNavigator":
              surfpack.ui.toggleNavigator(show);
              break;
          }
        }

        // Add event listeners for UI component checkboxes
        codeEditorCheckbox.addEventListener("change", (e) => {
          toggleUIComponent("showCodeEditor", e.target.checked);
        });

        fileBrowserCheckbox.addEventListener("change", (e) => {
          toggleUIComponent("showFileBrowser", e.target.checked);
        });

        navigatorCheckbox.addEventListener("change", (e) => {
          toggleUIComponent("showNavigator", e.target.checked);
        });

        // Initialize on load
        initSurfpack();

        console.log("Surfpack Online Demo initialized!");
      }
    </script>
  </body>
</html>
